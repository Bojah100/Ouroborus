<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ouroborus Vesica â€” Return of the Snake | Sagittarius A*</title>
<div style="
  position: fixed;
  top: 20px;
  width: 100%;
  text-align: center;
  font-family: 'Cinzel', 'Orbitron', sans-serif;
  color: gold;
  text-shadow: -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
  z-index: 101;
  pointer-events: none;
">
  <div style="font-size: 48px; font-weight: bold;">Ouroborus Vesica</div>
  <div style="font-size: 30px;">Return of the Snake</div>
  <div style="font-size: 24px;">Sagittarius A*</div>
</div>


  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Orbitron:wght@600&display=swap" rel="stylesheet"/>
  <style>
    body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: #000 url('https://images.unsplash.com/photo-1462331940025-496dfbfc7564?auto=format&fit=crop&w=2000&q=80') center/cover no-repeat;
      animation: bgScroll 60s linear infinite;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'Cinzel', serif;
    }
    @keyframes bgScroll {
      0% { background-position: 50% 50%; }
      50% { background-position: 50% 100%; }
      100% { background-position: 50% 50%; }
    }

    .cosmic-stage {
      position: relative;
      width: 80vmin;
      height: 80vmin;
      max-width: 400px;
      max-height: 400px;
    }
    @media (max-width: 600px) {
      .cosmic-stage { max-width: 80vw; max-height: 80vw; }
    }

    .event-horizon {
      position: absolute;
      width: 30%;
      height: 30%;
      top: 35%;
      left: 35%;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(0,0,0,0) 0%, rgba(0,0,0,0.9) 70%, black 100%);
      box-shadow: 0 0 80px rgba(0, 0, 0, 1);
      z-index: 10;
      animation: blackholePulse 1.3s infinite ease-in-out;
    }
    @keyframes blackholePulse {
      0%, 100% { transform: scale(1); opacity: 0.8; }
      50% { transform: scale(1.1); opacity: 1; }
    }

    .accretion-disc {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,215,0,0.6) 5%, rgba(255,165,0,0.4) 15%, rgba(255,69,0,0.2) 25%, transparent 50%);
      box-shadow: 0 0 40px rgba(255,215,0,1), 0 0 20px rgba(255,165,0,0.8), 0 0 10px rgba(255,69,0,0.6);
      animation: spinCW 35s linear infinite, pulseGlow 5s infinite ease-in-out;
      z-index: 3;
    }
    @keyframes spinCW {
      to { transform: rotate(360deg); }
    }
    @keyframes pulseGlow {
      0%, 100% { box-shadow: 0 0 40px rgba(255,215,0,1), 0 0 20px rgba(255,165,0,0.8), 0 0 10px rgba(255,69,0,0.6); }
      50% { box-shadow: 0 0 60px rgba(255,215,0,1.2), 0 0 30px rgba(255,165,0,1), 0 0 15px rgba(255,69,0,0.8); }
    }

    .vesica-circle {
      position: absolute;
      border: 3px solid #ffd700;
      border-radius: 50%;
      box-shadow: 0 0 20px #ffd700;
      z-index: 6;
      animation: colorShift 4s infinite;
    }
    .circle-left {
      width: 50%;
      height: 50%;
      top: 25%;
      left: 20%;
      animation: eyelidCycleLeft 36s infinite, colorShift 4s infinite;
    }
    .circle-right {
      width: 50%;
      height: 50%;
      top: 25%;
      left: 30%;
      animation: eyelidCycleRight 36s infinite, colorShift 4s infinite;
    }
    @keyframes eyelidCycleLeft {
      0% { transform: scale(1, 1) translateY(0); }
      3.7% { transform: scale(1, 0.2) translateY(0); }
      5.55% { transform: scale(0.025, 0.025) translateY(50%); }
      7.4% { transform: scale(1, 1) translateY(0); }
      11.1% { transform: scale(1, 1) translateY(-20%); }
      18.5% { transform: scale(1, 1) translateY(20%); }
      25.9% { transform: scale(1, 1) translateY(-20%); }
      96.3% { transform: scale(1, 1) translateY(0); }
      100% { transform: scale(1, 1) translateY(0); }
    }
    @keyframes eyelidCycleRight {
      0% { transform: scale(1, 1) translateY(0); }
      3.7% { transform: scale(1, 0.2) translateY(0); }
      5.55% { transform: scale(0.025, 0.025) translateY(-50%); }
      7.4% { transform: scale(1, 1) translateY(0); }
      11.1% { transform: scale(1, 1) translateY(20%); }
      18.5% { transform: scale(1, 1) translateY(-20%); }
      25.9% { transform: scale(1, 1) translateY(20%); }
      96.3% { transform: scale(1, 1) translateY(0); }
      100% { transform: scale(1, 1) translateY(0); }
    }
    @keyframes colorShift {
      0% { border-color: #ffd700; box-shadow: 0 0 20px #ffd700; }
      25% { border-color: #ff4500; box-shadow: 0 0 20px #ff4500; }
      50% { border-color: #ff69b4; box-shadow: 0 0 20px #ff69b4; }
      75% { border-color: #00b7eb; box-shadow: 0 0 20px #00b7eb; }
      100% { border-color: #ffd700; box-shadow: 0 0 20px #ffd700; }
    }

    .ouroboros {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      filter: brightness(0.9) drop-shadow(0 0 15px gold);
      z-index: 4;
      animation: spinCCW 36s linear infinite;
    }
    @keyframes spinCCW {
      to { transform: rotate(-360deg); }
    }
    .ouroboros.electrified {
      filter: brightness(0.9) drop-shadow(0 0 15px gold) invert(100%) hue-rotate(180deg);
      animation: electrifiedFade 5s ease-out forwards;
    }
    @keyframes electrifiedFade {
      0% { filter: brightness(0.9) drop-shadow(0 0 15px gold) invert(100%) hue-rotate(180deg); }
      100% { filter: brightness(0.9) drop-shadow(0 0 15px gold); }
    }

    .chakra-node {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      box-shadow: 0 0 10px currentColor;
      z-index: 11;
      animation: nodePulse 2s infinite ease-in-out;
    }
    @keyframes nodePulse {
      0%, 100% { transform: scale(1); opacity: 0.7; }
      50% { transform: scale(1.5); opacity: 1; }
    }

    .prime-path {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 9;
    }
    .path-line {
      position: absolute;
      background: rgba(255,215,0,0.5);
      height: 2px;
      transform-origin: 0 0;
      z-index: 8;
    }

    #metatronCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 2;
      pointer-events: none;
    }

    /* METATRON BUTTON STYLE */
    #metatronButton {
      position: fixed;
      top: 30px;
      left: 20px;
      padding: 15px 30px;
      background: radial-gradient(circle, rgba(0,183,235,0.8) 0%, rgba(255,105,180,0.8) 100%);
      color: white;
      border: 2px solid gold;
      border-radius: 25px;
      font-family: 'Orbitron', sans-serif;
      font-size: 20px;
      text-decoration: none;
      text-align: center;
      z-index: 100;
      box-shadow: 0 0 20px rgba(255,215,0,0.8);
      pointer-events: auto;
      -webkit-text-stroke: 1px black;
    }

    .prime-toggle {
      position: fixed;
      bottom: 260px;
      left: 20px;
      color: gold;
      font-family: 'Orbitron', sans-serif;
      font-size: 16px;
      background: rgba(0,0,0,0.7);
      padding: 8px 15px;
      border-radius: 15px;
      cursor: pointer;
      z-index: 100;
      border: 1px solid rgba(255,215,0,0.3);
      pointer-events: auto;
      -webkit-text-stroke: 1px black;
    }
    .prime-toggle:hover {
      background: rgba(0,0,0,0.9);
      box-shadow: 0 0 10px rgba(255,215,0,0.5);
    }

    .prime-legend {
      position: fixed;
      bottom: 270px;
      left: 20px;
      color: gold;
      font-family: 'Orbitron', sans-serif;
      font-size: 16px;
      background: rgba(0,0,0,0.8);
      padding: 10px;
      border-radius: 5px;
      max-width: 300px;
      z-index: 100;
      display: none;
      border: 1px solid rgba(255,215,0,0.5);
      box-shadow: 0 0 15px rgba(255,215,0,0.3);
      max-height: 400px;
      overflow-y: auto;
      -webkit-text-stroke: 1px black;
    }

    #welcomeButton {
      position: fixed;
      bottom: 30px;
      padding: 18px 35px;
      background: radial-gradient(circle, rgba(255,105,180,0.8) 0%, rgba(0,183,235,0.8) 100%), radial-gradient(rgba(0,0,0,1) 20%, transparent 21%) 0 0 / 15px 15px;
      color: white;
      border: 2px solid gold;
      border-radius: 30px;
      font-family: 'Orbitron', sans-serif;
      font-size: 22px;
      cursor: pointer;
      z-index: 100;
      box-shadow: 0 0 20px rgba(255,215,0,0.8);
      pointer-events: auto;
      -webkit-text-stroke: 1px black;
    }

    #storeButton {
      position: fixed;
      bottom: 120px;
      padding: 20px 40px;
      background: radial-gradient(circle, rgba(255,105,180,0.8) 0%, rgba(0,183,235,0.8) 100%), radial-gradient(rgba(0,0,0,1) 20%, transparent 21%) 0 0 / 15px 15px;
      color: white;
      border: 2px solid gold;
      border-radius: 30px;
      font-family: 'Orbitron', sans-serif;
      font-size: 22px;
      cursor: pointer;
      z-index: 100;
      box-shadow: 0 0 20px rgba(255,215,0,0.8);
      text-decoration: none;
      text-align: center;
      pointer-events: auto;
      -webkit-text-stroke: 1px black;
    }

    #storeButton:hover, #welcomeButton:hover {
      box-shadow: 0 0 30px rgba(255,215,0,1);
    }

    #audioStatus {
      position: fixed;
      bottom: 180px;
      color: gold;
      font-family: 'Orbitron', sans-serif;
      font-size: 14px;
      z-index: 100;
      background: rgba(0,0,0,0.7);
      padding: 8px 15px;
      border-radius: 5px;
      -webkit-text-stroke: 1px black;
    }
  </style>
</head>
<body>

<!-- ðŸŒŸ ADDING THE PORTAL BUTTON -->
<a id="metatronButton" href="metatron.html">âœ¨ Enter the Metatron Engine âœ¨</a>

<!-- Your existing Landing Page content starts here -->
<canvas id="metatronCanvas"></canvas>
<div class="cosmic-stage">
  <div class="accretion-disc"></div>
  <div class="event-horizon"></div>
  <img class="ouroboros" src="https://cdn.pixabay.com/photo/2021/07/07/04/42/dragon-6393190_1280.png?cache_bust=2025" alt="Ouroboros" onerror="this.src='fallback-dragon.png'">
  <div class="vesica-circle circle-left"></div>
  <div class="vesica-circle circle-right"></div>
  <div class="prime-path" id="primePath"></div>
</div>

<!-- Your Welcome Buttons and Store Buttons -->
<button id="welcomeButton" aria-label="Toggle celestial harmonics">Key of the Milky Way</button>
<a id="storeButton" href="https://satterbrock.gumroad.com/" target="_blank" rel="noopener noreferrer" aria-label="Visit store">Explore Celestial Artifacts</a>

<div id="audioStatus"></div>
<div class="prime-toggle" id="primeToggle" role="button" tabindex="0" aria-label="Toggle prime keys legend">Show Prime Keys</div>
<div class="prime-legend" id="primeLegend"></div>

<script>
    // Logging
    function log(message) {
      console.log(`[Ouroborus Vesica] ${message}`);
      const audioStatus = document.getElementById('audioStatus');
      audioStatus.textContent = message;
      setTimeout(() => audioStatus.textContent = 'Audio active', 2000);
    }

    // Prime Generation
    function generatePrimes() {
      const primes = [];
      for (let n = 2; n <= 1836; n++) {
        let isPrime = true;
        for (let i = 2; i <= Math.sqrt(n); i++) {
          if (n % i === 0) {
            isPrime = false;
            break;
          }
        }
        if (isPrime) primes.push(n);
      }
      primes.push(1836);
      return primes;
    }

    // Metatron Cube Engine
    class MetatronCubeEngine {
      constructor() {
        this.canvas = document.getElementById('metatronCanvas');
        this.ctx = this.canvas.getContext('2d');
        this.resizeCanvas();
        window.addEventListener('resize', () => this.resizeCanvas());
        this.center = { x: this.width / 2, y: this.height / 2 };
        this.scale = Math.min(this.width, this.height) / 5;
        this.rotation = 0;
        this.primes = generatePrimes();
        this.lnPrimes = this.primes.map(p => Math.log(p));
        this.animate = this.animate.bind(this);
        requestAnimationFrame(this.animate);
      }
      resizeCanvas() {
        this.width = this.canvas.width = window.innerWidth;
        this.height = this.canvas.height = window.innerHeight;
        this.center = { x: this.width / 2, y: this.height / 2 };
        this.scale = Math.min(this.width, this.height) / 5;
      }
      drawCentralSeed() {
        this.ctx.beginPath();
        this.ctx.arc(0, 0, this.scale * 0.15, 0, Math.PI * 2);
        this.ctx.strokeStyle = 'gold';
        this.ctx.lineWidth = 3;
        this.ctx.stroke();
        this.ctx.closePath();
      }
      drawMetatronCore() {
        const nodeRadius = this.scale * 0.15;
        const points = [];
        for (let i = 0; i < 6; i++) {
          const angle = (i * Math.PI) / 3;
          points.push({ x: nodeRadius * Math.cos(angle), y: nodeRadius * Math.sin(angle) });
        }
        this.ctx.strokeStyle = '#00b7eb';
        this.ctx.lineWidth = 1.5;
        this.ctx.beginPath();
        for (let i = 0; i < 6; i++) {
          const p1 = points[i];
          const p2 = points[(i + 1) % 6];
          this.ctx.moveTo(p1.x, p1.y);
          this.ctx.lineTo(p2.x, p2.y);
        }
        this.ctx.stroke();
        this.ctx.closePath();
        this.ctx.beginPath();
        points.forEach(p => {
          this.ctx.moveTo(0, 0);
          this.ctx.lineTo(p.x, p.y);
        });
        this.ctx.stroke();
        this.ctx.closePath();
      }
      drawPrimeSpiral(timestamp) {
        const t = timestamp * 0.0004;
        this.lnPrimes.forEach((lnp, i) => {
          const baseAngle = i * 0.22;
          const baseRadius = this.scale * (0.2 + lnp / 8);
          const dnaWave = Math.sin(t + i * 0.3) * 15;
          const x = baseRadius * Math.cos(baseAngle);
          const y = baseRadius * Math.sin(baseAngle) + dnaWave;
          this.ctx.beginPath();
          this.ctx.arc(x, y, 3, 0, Math.PI * 2);
          this.ctx.fillStyle = `hsl(${(i * 36) % 360}, 80%, 60%)`;
          this.ctx.fill();
          this.ctx.closePath();
          if (i % 2 === 0 && i < this.lnPrimes.length - 1) {
            const nextLnp = this.lnPrimes[i + 1];
            const nextAngle = (i + 1) * 0.22;
            const nextRadius = this.scale * (0.2 + nextLnp / 8);
            const nextDnaWave = Math.sin(t + (i + 1) * 0.3) * 15;
            const x2 = nextRadius * Math.cos(nextAngle);
            const y2 = nextRadius * Math.sin(nextAngle) + nextDnaWave;
            this.ctx.strokeStyle = `hsl(${(i * 36 + 180) % 360}, 100%, 70%)`;
            this.ctx.lineWidth = 0.8;
            this.ctx.beginPath();
            this.ctx.moveTo(x, y);
            this.ctx.lineTo(x2, y2);
            this.ctx.stroke();
            this.ctx.closePath();
          }
        });
      }
      animate(timestamp) {
        this.ctx.clearRect(0, 0, this.width, this.height);
        this.ctx.save();
        this.ctx.translate(this.center.x, this.center.y);
        this.ctx.rotate(this.rotation);
        this.drawCentralSeed();
        this.drawMetatronCore();
        this.drawPrimeSpiral(timestamp);
        this.ctx.restore();
        this.rotation += 0.0005;
        requestAnimationFrame(this.animate);
      }
    }

    // Prime Interpretations
    const primes = generatePrimes();
    const primeInterpretations = {
      2: { freq: 261.63, name: "Binary Breath", desc: "Vesica pulse initiator", color: `hsl(0, 80%, 60%)` },
      3: { freq: 277.18, name: "Recursion Memory", desc: "Trinitic fold stabilizer", color: `hsl(120, 80%, 60%)` },
      5: { freq: 293.66, name: "Pentatonic Resonance", desc: "Mass binding harmonic", color: `hsl(240, 80%, 60%)` },
      1836: { freq: 432.00, name: "Quantum Foam Stabilizer", desc: "Zero-point field anchor", color: `hsl(0, 80%, 60%)` }
    };
    primes.forEach((prime, i) => {
      if (!primeInterpretations[prime]) {
        const freq = 261.63 * Math.pow(2, (i % 36) / 12);
        primeInterpretations[prime] = {
          freq: prime <= 89 ? freq : null,
          name: `Prime ${prime}`,
          desc: `Harmonic node ${prime}`,
          color: `hsl(${i * 7 % 360}, 80%, 60%)`
        };
      }
    });
    primeInterpretations[1836].freq = 432.00;

    // Populate Prime Legend
    function populatePrimeLegend() {
      const primeLegend = document.getElementById('primeLegend');
      primeLegend.innerHTML = '';
      primes.forEach(prime => {
        const div = document.createElement('div');
        const interpretation = primeInterpretations[prime];
        div.innerHTML = `<strong>${interpretation.name}</strong>: ${interpretation.desc}`;
        primeLegend.appendChild(div);
      });
      log('Prime legend populated');
    }

    // Chakra Nodes and Connections
    function createPrimePathSystem() {
      const primePath = document.getElementById('primePath');
      primes.slice(0, 50).forEach((prime, index) => {
        const node = document.createElement('div');
        node.className = 'chakra-node';
        node.dataset.prime = prime;
        node.style.backgroundColor = primeInterpretations[prime].color;
        primePath.appendChild(node);
      });
      log('50 chakra nodes created');
    }

    function updateNodePositions(timestamp) {
      if (!isAnimating) return requestAnimationFrame(updateNodePositions);
      const nodes = document.querySelectorAll('.chakra-node');
      const phi = (1 + Math.sqrt(5)) / 2;
      nodes.forEach((node, index) => {
        const angle = (timestamp / 1000) * (360 / (288 / (index + 1))) % 360;
        const baseRadius = 120 + index * 8;
        const radius = baseRadius * Math.pow(phi, angle / 360);
        const x = 50 + (radius / 400) * 100 * Math.cos(angle * Math.PI / 180);
        const y = 50 + (radius / 400) * 100 * Math.sin(angle * Math.PI / 180);
        node.style.left = `${x}%`;
        node.style.top = `${y}%`;
        node.style.display = 'block';
      });
      drawPrimeConnections();
      requestAnimationFrame(updateNodePositions);
    }

    function drawPrimeConnections() {
      const existingLines = document.querySelectorAll('.path-line');
      existingLines.forEach(line => line.remove());
      const nodes = document.querySelectorAll('.chakra-node');
      nodes.forEach((node1, i) => {
        const prime1 = parseInt(node1.dataset.prime);
        nodes.forEach((node2, j) => {
          if (i < j) {
            const prime2 = parseInt(node2.dataset.prime);
            if (Math.abs(prime1 - prime2) <= 10) {
              const x1 = parseFloat(node1.style.left);
              const y1 = parseFloat(node1.style.top);
              const x2 = parseFloat(node2.style.left);
              const y2 = parseFloat(node2.style.top);
              const line = document.createElement('div');
              line.className = 'path-line';
              const length = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
              const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
              line.style.width = `${length}%`;
              line.style.left = `${x1}%`;
              line.style.top = `${y1}%`;
              line.style.transform = `rotate(${angle}deg)`;
              document.getElementById('primePath').appendChild(line);
            }
          }
        });
      });
      log('Prime path connections drawn');
    }

    // Audio System
    let audioContext, gainNode, isPlaying = false, isAnimating = true;
    function initAudio() {
      try {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        gainNode = audioContext.createGain();
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.connect(audioContext.destination);
        audioContext.resume().then(() => {
          isPlaying = true;
          isAnimating = true;
          document.getElementById('audioStatus').textContent = 'Celestial harmonics active';
          document.getElementById('welcomeButton').textContent = 'Pause Celestial Harmonics';
          log('Audio context resumed');
        }).catch(err => {
          log(`Audio resume failed: ${err}`);
          document.getElementById('audioStatus').textContent = 'Click to activate harmonics';
        });
      } catch (err) {
        log(`Audio init failed: ${err}`);
        document.getElementById('audioStatus').textContent = 'Audio failed. Click to retry.';
      }
    }

    function createGongDrone() {
      const osc = audioContext.createOscillator();
      const noteGain = audioContext.createGain();
      osc.type = 'sine';
      osc.frequency.setValueAtTime(42.7, audioContext.currentTime);
      noteGain.gain.setValueAtTime(0.5, audioContext.currentTime);
      noteGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 8);
      osc.connect(noteGain);
      noteGain.connect(gainNode);
      osc.start();
      osc.stop(audioContext.currentTime + 8);
      log('Javanese gong at 42.7 Hz');
    }

    function createPrimeChorus(prime) {
      if (audioContext.state === 'suspended') audioContext.resume();
      const baseFreq = primeInterpretations[prime].freq || 261.63;
      const osc = audioContext.createOscillator();
      const noteGain = audioContext.createGain();
      osc.type = 'sine';
      osc.frequency.setValueAtTime(baseFreq, audioContext.currentTime);
      noteGain.gain.setValueAtTime(0.3, audioContext.currentTime);
      noteGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 8);
      osc.connect(noteGain);
      noteGain.connect(gainNode);
      osc.start();
      osc.stop(audioContext.currentTime + 8);
      log(`Prime chorus for ${prime}: ${baseFreq} Hz`);
    }

    function createHeartbeat() {
      if (audioContext.state === 'suspended') audioContext.resume();
      const sineOsc = audioContext.createOscillator();
      const sineGain = audioContext.createGain();
      sineOsc.type = 'sine';
      sineOsc.frequency.setValueAtTime(80, audioContext.currentTime);
      sineGain.gain.setValueAtTime(0, audioContext.currentTime);
      sineGain.gain.linearRampToValueAtTime(1.2, audioContext.currentTime + 0.1);
      sineGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.8);
      sineOsc.connect(sineGain);
      sineGain.connect(gainNode);
      sineOsc.start();
      sineOsc.stop(audioContext.currentTime + 0.8);
      log('Heartbeat at 80 Hz');
    }

    document.getElementById('welcomeButton').addEventListener('click', () => {
      if (!audioContext) {
        initAudio();
      } else if (audioContext.state === 'suspended') {
        audioContext.resume().then(() => {
          isPlaying = true;
          isAnimating = true;
          document.getElementById('audioStatus').textContent = 'Celestial harmonics active';
          document.getElementById('welcomeButton').textContent = 'Pause Celestial Harmonics';
          log('Audio resumed');
        });
      } else {
        isPlaying = !isPlaying;
        isAnimating = !isAnimating;
        document.getElementById('audioStatus').textContent = isPlaying ? 'Celestial harmonics active' : 'Harmonics and orbits paused';
        document.getElementById('welcomeButton').textContent = isPlaying ? 'Pause Celestial Harmonics' : 'Key of the Milky Way';
        gainNode.gain.setValueAtTime(isPlaying ? 0.1 : 0, audioContext.currentTime);
        log(`Audio: ${isPlaying ? 'On' : 'Off'}, Animation: ${isAnimating ? 'On' : 'Off'}`);
      }
    });

    // Prime Legend Toggle
    document.getElementById('primeToggle').addEventListener('click', () => {
      const primeLegend = document.getElementById('primeLegend');
      const isVisible = primeLegend.style.display === 'block';
      primeLegend.style.display = isVisible ? 'none' : 'block';
      document.getElementById('primeToggle').textContent = isVisible ? 'Show Prime Keys' : 'Hide Prime Keys';
      log(`Prime legend toggled to ${primeLegend.style.display}`);
    });

    // Harmonic Clock
    let currentPrimeIndex = 0, lastPhaseShift = 0;
    function harmonicClock(timestamp) {
      const elapsed = timestamp / 1000;
      const cycleTime = 36;
      const cycleElapsed = elapsed % cycleTime;
      const currentAngle = (cycleElapsed / cycleTime) * 360;

      if (elapsed - lastPhaseShift >= (12 / 360) * cycleTime) {
        if (isPlaying && audioContext?.state === 'running') {
          createHeartbeat();
          const ouroboros = document.querySelector('.ouroboros');
          ouroboros.style.transform = `rotate(-${currentAngle}deg) scale(1.05)`;
          setTimeout(() => {
            ouroboros.style.transform = `rotate(-${currentAngle}deg) scale(1)`;
          }, 200);
        }
        lastPhaseShift = elapsed;
        log('12Â° phase shift with heartbeat');
      }

      if (elapsed % 1 < 0.1 && isPlaying && audioContext?.state === 'running') {
        const prime = primes[currentPrimeIndex % primes.length];
        createPrimeChorus(prime);
        currentPrimeIndex++;
      }

      if (cycleElapsed % 72 < 0.1 && isPlaying && audioContext?.state === 'running') {
        createGongDrone();
      }

      if (Math.abs(currentAngle - 19.47) < 0.1) {
        const ouroboros = document.querySelector('.ouroboros');
        ouroboros.classList.add('electrified');
        setTimeout(() => ouroboros.classList.remove('electrified'), 5000);
        log('Electrified Ouroboros at 19.47Â° with 5s fade');
      }

      requestAnimationFrame(harmonicClock);
    }

    // Initialize
    window.addEventListener('load', () => {
      new MetatronCubeEngine();
      populatePrimeLegend();
      createPrimePathSystem();
      requestAnimationFrame(updateNodePositions);
      requestAnimationFrame(harmonicClock);
      log('Page initialized with Metatron Cube, chakra nodes, audio, and prime toggle');
    });
  </script>
</body>
</html>
