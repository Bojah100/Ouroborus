<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Ouroborus Vesica — Return of the Snake</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Orbitron:wght@600&display=swap" rel="stylesheet"/>
  <style>
    body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: #000 url('https://images.unsplash.com/photo-1462331940025-496dfbfc7564?auto=format&fit=crop&w=2000&q=80') center/cover no-repeat;
      animation: bgScroll 60s linear infinite;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-family: 'Cinzel', serif;
    }
    @keyframes bgScroll {
      0% { background-position: 50% 50%; }
      50% { background-position: 50% 100%; }
      100% { background-position: 50% 50%; }
    }

    .star-particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }
    .star {
      position: absolute;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 50%;
      animation: twinkle 5s infinite ease-in-out;
    }
    @keyframes twinkle {
      0%, 100% { opacity: 0.2; transform: scale(0.5); }
      50% { opacity: 1; transform: scale(1); }
    }

    .title-container {
      position: fixed;
      top: 30px;
      text-align: center;
      color: gold;
      text-shadow: 0 0 15px #ffd700, 0 0 25px #ff4500;
      z-index: 100;
    }
    .title {
      font-size: 4vmin;
      font-weight: 700;
      margin: 0;
      letter-spacing: 2px;
      -webkit-text-stroke: 1px black;
    }
    .subtitle {
      font-size: 2.5vmin;
      font-family: 'Orbitron', sans-serif;
      margin: 8px 0;
      letter-spacing: 1px;
      -webkit-text-stroke: 1px black;
    }

    .cosmic-stage {
      position: relative;
      width: 80vmin;
      height: 80vmin;
      max-width: 400px;
      max-height: 400px;
      margin-bottom: 60px;
    }

    @media (max-width: 600px) {
      .cosmic-stage {
        max-width: 80vw;
        max-height: 80vw;
      }
    }

    .event-horizon {
      position: absolute;
      width: 30%;
      height: 30%;
      top: 35%;
      left: 35%;
      border-radius: 50%;
      background: radial-gradient(circle, 
        rgba(0,0,0,0) 0%, 
        rgba(0,0,0,0.9) 70%, 
        black 100%);
      box-shadow: 0 0 80px rgba(0, 0, 0, 1);
      z-index: 10;
      animation: blackholePulse 1.3s infinite ease-in-out;
    }
    @keyframes blackholePulse {
      0%, 100% { transform: scale(1); opacity: 0.8; }
      50% { transform: scale(1.1); opacity: 1; }
    }

    .ouroboros {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      filter: brightness(0.9) drop-shadow(0 0 15px gold);
      z-index: 4;
      animation: spinCCW 36s linear infinite;
    }
    @keyframes spinCCW {
      to { transform: rotate(-360deg); }
    }

    .accretion-disc {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,215,0,0.6) 5%, rgba(255,165,0,0.4) 15%, rgba(255,69,0,0.2) 25%, transparent 50%);
      box-shadow: 0 0 40px rgba(255,215,0,1), 0 0 20px rgba(255,165,0,0.8), 0 0 10px rgba(255,69,0,0.6);
      animation: spinCW 35s linear infinite, pulseGlow 5s infinite ease-in-out;
      z-index: 3;
    }
    @keyframes spinCW {
      to { transform: rotate(360deg); }
    }
    @keyframes pulseGlow {
      0%, 100% { box-shadow: 0 0 40px rgba(255,215,0,1), 0 0 20px rgba(255,165,0,0.8), 0 0 10px rgba(255,69,0,0.6); }
      50% { box-shadow: 0 0 60px rgba(255,215,0,1.2), 0 0 30px rgba(255,165,0,1), 0 0 15px rgba(255,69,0,0.8); }
    }

    .vesica-circle {
      position: absolute;
      border: 3px solid #ffd700;
      border-radius: 50%;
      box-shadow: 0 0 20px #ffd700;
      z-index: 6;
      animation: colorShift 4s infinite;
    }
    .circle-left {
      width: 50%;
      height: 50%;
      top: 25%;
      left: 20%;
      animation: eyelidCycleLeft 36s infinite, colorShift 4s infinite;
    }
    .circle-right {
      width: 50%;
      height: 50%;
      top: 25%;
      left: 30%;
      animation: eyelidCycleRight 36s infinite, colorShift 4s infinite;
    }
    @keyframes eyelidCycleLeft {
      0% { transform: scale(1, 1) translateY(0); }
      3.7% { transform: scale(1, 0.2) translateY(0); }
      5.55% { transform: scale(0.025, 0.025) translateY(50%); }
      7.4% { transform: scale(1, 1) translateY(0); }
      11.1% { transform: scale(1, 1) translateY(-20%); }
      18.5% { transform: scale(1, 1) translateY(20%); }
      25.9% { transform: scale(1, 1) translateY(-20%); }
      96.3% { transform: scale(1, 1) translateY(0); }
      100% { transform: scale(1, 1) translateY(0); }
    }
    @keyframes eyelidCycleRight {
      0% { transform: scale(1, 1) translateY(0); }
      3.7% { transform: scale(1, 0.2) translateY(0); }
      5.55% { transform: scale(0.025, 0.025) translateY(-50%); }
      7.4% { transform: scale(1, 1) translateY(0); }
      11.1% { transform: scale(1, 1) translateY(20%); }
      18.5% { transform: scale(1, 1) translateY(-20%); }
      25.9% { transform: scale(1, 1) translateY(20%); }
      96.3% { transform: scale(1, 1) translateY(0); }
      100% { transform: scale(1, 1) translateY(0); }
    }
    @keyframes colorShift {
      0% { border-color: #ffd700; box-shadow: 0 0 20px #ffd700; }
      25% { border-color: #ff4500; box-shadow: 0 0 20px #ff4500; }
      50% { border-color: #ff69b4; box-shadow: 0 0 20px #ff69b4; }
      75% { border-color: #00b7eb; box-shadow: 0 0 20px #00b7eb; }
      100% { border-color: #ffd700; box-shadow: 0 0 20px #ffd700; }
    }

    .light-burst {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      background: radial-gradient(circle, rgba(255,255,255,0.8) 10%, rgba(255,215,0,0.4) 50%, transparent 70%);
      opacity: 0;
      transform: scale(0);
      z-index: 5;
      animation: lightBurst 36s infinite;
    }
    @keyframes lightBurst {
      0%, 5.55% { opacity: 0; transform: scale(0); }
      5.56% { opacity: 1; transform: scale(0.1); }
      7.4% { opacity: 0; transform: scale(1); }
      100% { opacity: 0; transform: scale(1); }
    }

    .plasma-field {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      background: radial-gradient(circle, rgba(255,69,0,0.15) 10%, transparent 70%);
      animation: plasmaPulse 4s infinite ease-in-out;
      z-index: 1;
    }
    @keyframes plasmaPulse {
      0%, 100% { opacity: 0.3; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(1.05); }
    }

    .cymatic-field {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      background: radial-gradient(circle, rgba(0,183,235,0.5) 10%, rgba(255,105,180,0.4) 30%, rgba(128,0,128,0.3) 50%, rgba(255,215,0,0.2) 70%, transparent 80%);
      z-index: 2;
      animation: cymaticWave 2s infinite ease-in-out, cymaticMorph 4s infinite ease-in-out, cymaticVibrate 0.0234s infinite ease-in-out;
      clip-path: polygon(50% 10%, 70% 20%, 90% 50%, 70% 80%, 50% 90%, 30% 80%, 10% 50%, 30% 20%);
      transform: perspective(600px) rotateX(50deg);
      box-shadow: 0 0 30px rgba(0,183,235,0.6);
    }
    @keyframes cymaticWave {
      0%, 100% { transform: perspective(600px) rotateX(50deg) scale(1); opacity: 0.5; }
      50% { transform: perspective(600px) rotateX(50deg) scale(1.15); opacity: 0.8; }
    }
    @keyframes cymaticMorph {
      0% { clip-path: polygon(50% 10%, 70% 20%, 90% 50%, 70% 80%, 50% 90%, 30% 80%, 10% 50%, 30% 20%); }
      50% { clip-path: polygon(55% 15%, 75% 25%, 85% 55%, 75% 85%, 45% 85%, 25% 75%, 15% 45%, 25% 15%); }
      100% { clip-path: polygon(50% 10%, 70% 20%, 90% 50%, 70% 80%, 50% 90%, 30% 80%, 10% 50%, 30% 20%); }
    }
    @keyframes cymaticVibrate {
      0% { transform: perspective(600px) rotateX(50deg) scale(1); }
      50% { transform: perspective(600px) rotateX(50deg) scale(1.02); }
      100% { transform: perspective(600px) rotateX(50deg) scale(1); }
    }

    .chakra-node {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      box-shadow: 0 0 10px currentColor;
      z-index: 11;
      animation: nodePulse 2s infinite ease-in-out, colorVeneer 10s infinite ease-in-out;
    }
    @keyframes nodePulse {
      0%, 100% { transform: scale(1); opacity: 0.7; }
      50% { transform: scale(1.5); opacity: 1; }
    }
    @keyframes colorVeneer {
      0% { filter: hue-rotate(0deg); }
      50% { filter: hue-rotate(180deg); }
      100% { filter: hue-rotate(360deg); }
    }

    .prime-path {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 9;
    }
    .path-line {
      position: absolute;
      background: rgba(255,215,0,0.5);
      height: 2px;
      transform-origin: 0 0;
      z-index: 8;
    }

    .shimmer-field {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 150;
    }
    .sparkle {
      position: absolute;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 50%;
      animation: sparkleTwinkle 2s ease-in-out, shineGlow 2s ease-in-out;
    }
    @keyframes sparkleTwinkle {
      0% { opacity: 0; transform: scale(0.5); }
      50% { opacity: 0.9; transform: scale(1.3); }
      100% { opacity: 0; transform: scale(0.5); }
    }
    @keyframes shineGlow {
      0% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
      50% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.8); }
      100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
    }

    #welcomeButton {
      position: fixed;
      padding: 18px 35px;
      background: 
        radial-gradient(circle at center, 
          rgba(255, 105, 180, 0.8) 0%, 
          rgba(0, 183, 235, 0.8) 100%),
        radial-gradient(rgba(0, 0, 0, 1) 20%, transparent 21%) 0 0 / 15px 15px;
      color: white;
      border: 2px solid gold;
      border-radius: 30px;
      font-family: 'Orbitron', sans-serif;
      font-weight: bold;
      font-size: 22px;
      cursor: pointer;
      z-index: 100;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
      transition: box-shadow 0.3s ease;
      bottom: 30px;
      pointer-events: auto;
      -webkit-text-stroke: 1px black;
    }

    #storeButton {
      position: fixed;
      padding: 20px 40px;
      background: 
        radial-gradient(circle at center, 
          rgba(255, 105, 180, 0.8) 0%, 
          rgba(0, 183, 235, 0.8) 100%),
        radial-gradient(rgba(0, 0, 0, 1) 20%, transparent 21%) 0 0 / 15px 15px;
      color: white;
      border: 2px solid gold;
      border-radius: 30px;
      font-family: 'Orbitron', sans-serif;
      font-weight: bold;
      font-size: 22px;
      cursor: pointer;
      z-index: 2000;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
      bottom: 120px;
      text-decoration: none;
      display: inline-block;
      text-align: center;
      pointer-events: auto;
      -webkit-text-stroke: 1px black;
    }

    #storeButton:hover, #welcomeButton:hover {
      box-shadow: 0 0 30px rgba(255, 215, 0, 1);
    }

    #audioStatus {
      position: fixed;
      bottom: 180px;
      color: gold;
      font-family: 'Orbitron', sans-serif;
      font-size: 14px;
      z-index: 100;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px 15px;
      border-radius: 5px;
      max-width: 300px;
      text-align: center;
      -webkit-text-stroke: 1px black;
      text-shadow: 0 0 3px rgba(0, 0, 0, 0.8);
    }

    #audioDebug {
      position: fixed;
      bottom: 220px;
      color: gold;
      font-family: 'Orbitron', sans-serif;
      font-size: 12px;
      z-index: 100;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px 15px;
      border-radius: 5px;
      max-width: 300px;
      text-align: center;
      -webkit-text-stroke: 1px black;
      text-shadow: 0 0 3px rgba(0, 0, 0, 0.8);
    }

    .prime-legend {
      position: fixed;
      bottom: 270px;
      left: 20px;
      color: gold;
      font-family: 'Orbitron', sans-serif;
      font-size: 16px;
      background: rgba(0,0,0,0.8);
      padding: 10px;
      border-radius: 5px;
      max-width: 300px;
      z-index: 100;
      display: none;
      border: 1px solid rgba(255,215,0,0.5);
      box-shadow: 0 0 15px rgba(255,215,0,0.3);
      max-height: 400px;
      overflow-y: auto;
    }

    .prime-toggle {
      position: fixed;
      bottom: 260px;
      left: 20px;
      color: gold;
      font-family: 'Orbitron', sans-serif;
      font-size: 16px;
      background: rgba(0,0,0,0.7);
      padding: 8px 15px;
      border-radius: 15px;
      cursor: pointer;
      z-index: 100;
      border: 1px solid rgba(255,215,0,0.3);
      transition: all 0.3s ease;
      pointer-events: auto;
      -webkit-text-stroke: 1px black;
    }

    .prime-toggle:hover {
      background: rgba(0,0,0,0.9);
      box-shadow: 0 0 10px rgba(255,215,0,0.5);
    }

    .prime-pulse {
      position: absolute;
      font-family: 'Orbitron', sans-serif;
      font-weight: bold;
      font-size: 16px;
      pointer-events: none;
      z-index: 50;
      transition: all 1s ease-out;
      text-shadow: 0 0 5px currentColor;
      -webkit-text-stroke: 1px black;
    }

    .active-prime {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-family: 'Cinzel', serif;
      font-size: 24px;
      text-align: center;
      opacity: 0;
      transition: opacity 1s;
      z-index: 90;
      text-shadow: 0 0 10px gold;
    }

    .prime-name {
      font-size: 32px;
      color: gold;
      margin-bottom: 5px;
      -webkit-text-stroke: 1px black;
    }

    .prime-desc {
      font-family: 'Orbitron', sans-serif;
      font-size: 14px;
      color: #00b7eb;
      -webkit-text-stroke: 1px black;
    }

    .cosmic-ripple {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 8;
    }

    .ripple-circle {
      position: absolute;
      border-radius: 50%;
      border: 1px solid;
      transform: scale(0);
      opacity: 0;
      pointer-events: none;
    }

    .snake-trail {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 6;
    }

    .trail-segment {
      position: absolute;
      width: 20px;
      height: 20px;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><circle cx="10" cy="10" r="8" fill="gold" opacity="0.7"/></svg>');
      background-size: contain;
      opacity: 0;
    }
  </style>
</head>
<body>
  <div class="star-particles" id="starParticles"></div>
  <div class="shimmer-field" id="shimmerField"></div>
  <div class="title-container">
    <h1 class="title">Ouroborus Vesica</h1>
    <p class="subtitle">Return of the Snake</p>
    <p class="subtitle">Sgr A*</p>
  </div>
  <div class="cosmic-stage">
    <div class="plasma-field"></div>
    <div class="cymatic-field"></div>
    <div class="accretion-disc"></div>
    <div class="event-horizon"></div>
    <img class="ouroboros" src="https://cdn.pixabay.com/photo/2021/07/07/04/42/dragon-6393190_1280.png?cache_bust=2025" alt="Ouroboros" onerror="this.src='fallback-dragon.png'">
    <div class="vesica-circle circle-left"></div>
    <div class="vesica-circle circle-right"></div>
    <div class="light-burst"></div>
    <div class="prime-path" id="primePath"></div>
  </div>

  <div class="cosmic-ripple" id="cosmicRipple"></div>
  <div class="snake-trail" id="snakeTrail"></div>

  <div class="active-prime" id="activePrime">
    <div class="prime-name" id="primeName"></div>
    <div class="prime-desc" id="primeDesc"></div>
  </div>

  <button id="welcomeButton" aria-label="Toggle celestial harmonics">Key of the Milky Way</button>
  <a id="storeButton" href="https://satterbrock.gumroad.com/" target="_blank" rel="noopener noreferrer" aria-label="Visit store">Explore Celestial Artifacts</a>
  <div id="audioStatus">Click to activate celestial harmonics</div>
  <div id="audioDebug">Audio initializing...</div>

  <div class="prime-toggle" id="primeToggle" role="button" tabindex="0" aria-label="Toggle prime keys legend">Show Prime Keys</div>
  <div class="prime-legend" id="primeLegend"></div>

  <script>
    // Debugging function
    function log(message) {
      console.log(`[Ouroborus Vesica] ${message}`);
      const audioDebug = document.getElementById('audioDebug');
      audioDebug.textContent = message;
      setTimeout(() => {
        if (audioDebug.textContent === message) audioDebug.textContent = 'Audio active';
      }, 2000);
    }

    // Star Particles
    const starContainer = document.getElementById('starParticles');
    for (let i = 0; i < 50; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      star.style.width = `${Math.random() * 3 + 1}px`;
      star.style.height = star.style.width;
      star.style.left = `${Math.random() * 100}%`;
      star.style.top = `${Math.random() * 100}%`;
      star.style.animationDelay = `${Math.random() * 5}s`;
      starContainer.appendChild(star);
    }
    log('Star particles initialized');

    // Prime Chime Resonance System
    let audioContext, gainNode, isPlaying = false, isAnimating = true;
    const welcomeButton = document.getElementById('welcomeButton');
    const audioStatus = document.getElementById('audioStatus');
    const activePrimeDisplay = document.getElementById('activePrime');
    const primeName = document.getElementById('primeName');
    const primeDesc = document.getElementById('primeDesc');
    const shimmerField = document.getElementById('shimmerField');
    const ouroboros = document.querySelector('.ouroboros');
    const cosmicRipple = document.getElementById('cosmicRipple');
    const snakeTrail = document.getElementById('snakeTrail');
    const cymaticField = document.querySelector('.cymatic-field');
    const primePath = document.getElementById('primePath');
    const primeLegend = document.getElementById('primeLegend');

    // Prime number interpretations
    const primes = [2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229];
    const primeInterpretations = {
      2: { freq: 261.63, name: "Binary Breath", desc: "Vesica pulse initiator", color: `hsl(0, 80%, 60%)` },
      3: { freq: 277.18, name: "Recursion Memory", desc: "Trinitic fold stabilizer", color: `hsl(120, 80%, 60%)` },
      5: { freq: 293.66, name: "Pentatonic Resonance", desc: "Mass binding harmonic", color: `hsl(240, 80%, 60%)` },
      7: { freq: 311.13, name: "Polarity Node", desc: "β-decay threshold", color: `hsl(60, 80%, 60%)` },
      11: { freq: 329.63, name: "Dimensional Anchor", desc: "Field coherence lock", color: `hsl(300, 80%, 60%)` },
      13: { freq: 349.23, name: "Entropic Breaker", desc: "Chaos pattern disruptor", color: `hsl(180, 80%, 60%)` },
      17: { freq: 369.99, name: "Quark Lock Tone", desc: "Subatomic resonance", color: `hsl(30, 80%, 60%)` },
      19: { freq: 392.00, name: "Rotational Braid", desc: "Spin symmetry opener", color: `hsl(150, 80%, 60%)` },
      23: { freq: 415.30, name: "Lattice Rephaser", desc: "Crystal structure aligner", color: `hsl(270, 80%, 60%)` },
      29: { freq: 440.00, name: "Phase-Bridge", desc: "Interdimensional harmonic", color: `hsl(90, 80%, 60%)` },
      229: { freq: 1046.50, name: "Light Cone Harmonizer", desc: "Spacetime resonance", color: `hsl(350, 80%, 60%)` },
      1836: { freq: 432.00, name: "Quantum Foam Stabilizer", desc: "Zero-point field anchor", color: `hsl(0, 80%, 60%)` }
    };
    // Generate primes up to 1836
    function generatePrimes() {
      const allPrimes = [];
      for (let n = 2; n <= 1836; n++) {
        let isPrime = true;
        for (let i = 2; i <= Math.sqrt(n); i++) {
          if (n % i === 0) {
            isPrime = false;
            break;
          }
        }
        if (isPrime) allPrimes.push(n);
      }
      return allPrimes;
    }
    const allPrimes = generatePrimes();
    // Generate interpretations with unique names and functions
    const namePrefixes = ["Quantum", "Cosmic", "Harmonic", "Vesica", "Nodal", "Phase", "Resonant", "Cymatic", "Orbital", "Fractal"];
    const nameSuffixes = ["Pulse", "Wave", "Lock", "Bridge", "Node", "Resonator", "Field", "Harmonizer", "Anchor", "Catalyst"];
    const descFunctions = [
      "Stabilizes field coherence",
      "Amplifies harmonic resonance",
      "Aligns subatomic structures",
      "Modulates spacetime curvature",
      "Initiates recursive patterns",
      "Synchronizes phase transitions",
      "Balances entropic forces",
      "Anchors dimensional shifts",
      "Emits cymatic signatures",
      "Guides orbital dynamics"
    ];
    for (let i = 0; i < allPrimes.length; i++) {
      const prime = allPrimes[i];
      if (!primeInterpretations[prime]) {
        const freq = 261.63 * Math.pow(2, (i % 36) / 12);
        const namePrefix = namePrefixes[i % namePrefixes.length];
        const nameSuffix = nameSuffixes[i % nameSuffixes.length];
        const desc = descFunctions[i % descFunctions.length];
        primeInterpretations[prime] = {
          freq: prime <= 89 ? freq : null,
          lightFreq: prime > 89 ? 42.7 * (prime / 97) : null,
          name: `${namePrefix} ${nameSuffix} ${prime}`,
          desc: desc,
          color: `hsl(${i * 7 % 360}, 80%, 60%)`
        };
      }
    }
    primeInterpretations[1836].freq = 432.00;
    log('Prime interpretations loaded with 432 Hz for 1836');

    // Populate Prime Legend
    function populatePrimeLegend() {
      primeLegend.innerHTML = '';
      allPrimes.forEach(prime => {
        const div = document.createElement('div');
        const interpretation = primeInterpretations[prime];
        div.innerHTML = `<strong>${interpretation.name}</strong>: ${interpretation.desc}`;
        primeLegend.appendChild(div);
      });
      log('Prime legend populated with all primes');
    }

    // Audio Setup
    function initAudio() {
      try {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        gainNode = audioContext.createGain();
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.connect(audioContext.destination);
        audioContext.resume().then(() => {
          isPlaying = true;
          isAnimating = true;
          audioStatus.textContent = 'Celestial harmonics active';
          welcomeButton.textContent = 'Pause Celestial Harmonics';
          log(`Audio context resumed, state: ${audioContext.state}`);
        }).catch(err => {
          log(`Audio context resume failed: ${err}`);
          audioStatus.textContent = 'Click again to activate harmonics';
        });
      } catch (err) {
        log(`Audio initialization failed: ${err}`);
        audioStatus.textContent = 'Audio failed to initialize. Click to retry.';
      }
    }

    function createGongDrone() {
      const sineOsc = audioContext.createOscillator();
      const squareOsc = audioContext.createOscillator();
      const noteGain = audioContext.createGain();
      const filter = audioContext.createBiquadFilter();
      sineOsc.type = 'sine';
      squareOsc.type = 'square';
      sineOsc.frequency.setValueAtTime(42.7, audioContext.currentTime);
      squareOsc.frequency.setValueAtTime(42.7, audioContext.currentTime);
      filter.type = 'lowpass';
      filter.frequency.setValueAtTime(400, audioContext.currentTime);
      noteGain.gain.setValueAtTime(0.5, audioContext.currentTime);
      noteGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 8);
      sineOsc.connect(filter);
      squareOsc.connect(filter);
      filter.connect(noteGain);
      noteGain.connect(gainNode);
      sineOsc.start();
      squareOsc.start();
      sineOsc.stop(audioContext.currentTime + 8);
      squareOsc.stop(audioContext.currentTime + 8);
      log('Javanese gong played at 42.7 Hz');
    }

    function createCustomWave() {
      const real = new Float32Array(2);
      const imag = new Float32Array(2);
      real[0] = 0;
      imag[0] = 0;
      real[1] = 0.7; // 70% sine
      imag[1] = 0.3; // 30% triangle approximation
      return audioContext.createPeriodicWave(real, imag);
    }

    function createPrimeChorus(prime) {
      if (audioContext.state === 'suspended') {
        audioContext.resume().then(() => log(`Audio context resumed for prime chorus, state: ${audioContext.state}`));
      }
      const baseFreq = primeInterpretations[prime].freq || 261.63 * (prime / 2);
      const freqs = [baseFreq / 2, baseFreq, Math.min(baseFreq * 2, 20000)];
      freqs.forEach(freq => {
        const oscs = [
          { osc: audioContext.createOscillator(), detune: 0 },
          { osc: audioContext.createOscillator(), detune: 6 },
          { osc: audioContext.createOscillator(), detune: -6 },
          { osc: audioContext.createOscillator(), detune: 4 },
          { osc: audioContext.createOscillator(), detune: -4 },
          { osc: audioContext.createOscillator(), detune: 2 }
        ];
        const noteGain = audioContext.createGain();
        const lowPass = audioContext.createBiquadFilter();
        const highPass = audioContext.createBiquadFilter();
        lowPass.type = 'lowpass';
        lowPass.frequency.setValueAtTime(2500, audioContext.currentTime);
        highPass.type = 'highpass';
        highPass.frequency.setValueAtTime(200, audioContext.currentTime);
        oscs.forEach(({ osc, detune }) => {
          osc.setPeriodicWave(createCustomWave());
          osc.frequency.setValueAtTime(freq, audioContext.currentTime);
          osc.detune.setValueAtTime(detune, audioContext.currentTime);
          const lfo = audioContext.createOscillator();
          const lfoGain = audioContext.createGain();
          lfo.type = 'sine';
          lfo.frequency.setValueAtTime(7.5, audioContext.currentTime);
          lfoGain.gain.setValueAtTime(freq * 0.012, audioContext.currentTime);
          lfo.connect(lfoGain);
          lfoGain.connect(osc.frequency);
          lfo.start();
          lfo.stop(audioContext.currentTime + 8);
          osc.connect(lowPass);
        });
        lowPass.connect(highPass);
        highPass.connect(noteGain);
        noteGain.gain.setValueAtTime(0.3, audioContext.currentTime);
        noteGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 8);
        noteGain.connect(gainNode);
        oscs.forEach(({ osc }) => {
          osc.start();
          osc.stop(audioContext.currentTime + 8);
        });
      });
      log(`Choral prime chorus for ${prime}: ${freqs.join(', ')} Hz, sustain 8s, context state: ${audioContext.state}`);
      createWindEffect();
    }

    function createLightChorus(prime) {
      if (audioContext.state === 'suspended') {
        audioContext.resume().then(() => log(`Audio context resumed for light chorus, state: ${audioContext.state}`));
      }
      const baseFreq = 42.7 * (prime / 97);
      const freqs = [baseFreq / 2, baseFreq, baseFreq * 2];
      freqs.forEach(freq => {
        const oscs = [
          { osc: audioContext.createOscillator(), detune: 0 },
          { osc: audioContext.createOscillator(), detune: 6 },
          { osc: audioContext.createOscillator(), detune: -6 },
          { osc: audioContext.createOscillator(), detune: 4 },
          { osc: audioContext.createOscillator(), detune: -4 },
          { osc: audioContext.createOscillator(), detune: 2 }
        ];
        const noteGain = audioContext.createGain();
        const lowPass = audioContext.createBiquadFilter();
        const highPass = audioContext.createBiquadFilter();
        lowPass.type = 'lowpass';
        lowPass.frequency.setValueAtTime(2500, audioContext.currentTime);
        highPass.type = 'highpass';
        highPass.frequency.setValueAtTime(200, audioContext.currentTime);
        oscs.forEach(({ osc, detune }) => {
          osc.setPeriodicWave(createCustomWave());
          osc.frequency.setValueAtTime(freq, audioContext.currentTime);
          osc.detune.setValueAtTime(detune, audioContext.currentTime);
          const lfo = audioContext.createOscillator();
          const lfoGain = audioContext.createGain();
          lfo.type = 'sine';
          lfo.frequency.setValueAtTime(7.5, audioContext.currentTime);
          lfoGain.gain.setValueAtTime(freq * 0.012, audioContext.currentTime);
          lfo.connect(lfoGain);
          lfoGain.connect(osc.frequency);
          lfo.start();
          lfo.stop(audioContext.currentTime + 4);
          osc.connect(lowPass);
        });
        lowPass.connect(highPass);
        highPass.connect(noteGain);
        noteGain.gain.setValueAtTime(0.2, audioContext.currentTime);
        noteGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 4);
        noteGain.connect(gainNode);
        oscs.forEach(({ osc }) => {
          osc.start();
          osc.stop(audioContext.currentTime + 4);
        });
      });
      log(`Choral light chorus for ${prime}: ${freqs.join(', ')} Hz, sustain 4s, context state: ${audioContext.state}`);
      createWindEffect();
    }

    function createWindEffect() {
      const noise = audioContext.createBufferSource();
      const buffer = audioContext.createBuffer(1, audioContext.sampleRate * 2, audioContext.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i = 0; i < data.length; i++) {
        data[i] = Math.random() * 2 - 1;
      }
      noise.buffer = buffer;
      const filter = audioContext.createBiquadFilter();
      filter.type = 'bandpass';
      filter.frequency.setValueAtTime(3000, audioContext.currentTime);
      filter.Q.setValueAtTime(1, audioContext.currentTime);
      const noteGain = audioContext.createGain();
      noteGain.gain.setValueAtTime(0.05, audioContext.currentTime);
      noteGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 2);
      noise.connect(filter);
      filter.connect(noteGain);
      noteGain.connect(gainNode);
      noise.start();
      noise.stop(audioContext.currentTime + 2);
      log('Wind effect triggered');
    }

    function createHeartbeat() {
      if (audioContext.state === 'suspended') {
        audioContext.resume().then(() => log(`Audio context resumed for heartbeat, state: ${audioContext.state}`));
      }
      // Sine wave 1 for "lub"
      const sineOsc1 = audioContext.createOscillator();
      const sineGain1 = audioContext.createGain();
      sineOsc1.type = 'sine';
      sineOsc1.frequency.setValueAtTime(80, audioContext.currentTime);
      sineGain1.gain.setValueAtTime(0, audioContext.currentTime);
      sineGain1.gain.linearRampToValueAtTime(1.2, audioContext.currentTime + 0.1);
      sineGain1.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.8);
      sineOsc1.connect(sineGain1);
      sineGain1.connect(gainNode);
      sineOsc1.start();
      sineOsc1.stop(audioContext.currentTime + 0.8);
      // Sine wave 2 for harmonic reinforcement
      const sineOsc2 = audioContext.createOscillator();
      const sineGain2 = audioContext.createGain();
      sineOsc2.type = 'sine';
      sineOsc2.frequency.setValueAtTime(120, audioContext.currentTime);
      sineGain2.gain.setValueAtTime(0, audioContext.currentTime);
      sineGain2.gain.linearRampToValueAtTime(0.6, audioContext.currentTime + 0.1);
      sineGain2.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.8);
      sineOsc2.connect(sineGain2);
      sineGain2.connect(gainNode);
      sineOsc2.start();
      sineOsc2.stop(audioContext.currentTime + 0.8);
      // Noise burst for "dub"
      let noise, buffer;
      try {
        noise = audioContext.createBufferSource();
        buffer = audioContext.createBuffer(1, audioContext.sampleRate * 0.06, audioContext.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i = 0; i < data.length; i++) {
          data[i] = Math.random() * 2 - 1;
        }
        noise.buffer = buffer;
      } catch (e) {
        log(`Noise buffer failed: ${e}, using fallback oscillator`);
        noise = audioContext.createOscillator();
        noise.type = 'triangle';
        noise.frequency.setValueAtTime(80, audioContext.currentTime);
      }
      const filter = audioContext.createBiquadFilter();
      filter.type = 'bandpass';
      filter.frequency.setValueAtTime(200, audioContext.currentTime);
      filter.Q.setValueAtTime(1, audioContext.currentTime);
      const noiseGain = audioContext.createGain();
      noiseGain.gain.setValueAtTime(1.0, audioContext.currentTime);
      noiseGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.06);
      noise.connect(filter);
      filter.connect(noiseGain);
      noiseGain.connect(gainNode);
      noise.start(audioContext.currentTime + 0.12);
      noise.stop(audioContext.currentTime + 0.18);
      log(`Heartbeat triggered at ${audioContext.currentTime}: 80 Hz sine, 200 Hz noise, context state: ${audioContext.state}`);
    }

    welcomeButton.addEventListener('click', () => {
      if (!audioContext) {
        initAudio();
      } else {
        if (audioContext.state === 'suspended') {
          audioContext.resume().then(() => {
            isPlaying = true;
            isAnimating = true;
            audioStatus.textContent = 'Celestial harmonics active';
            welcomeButton.textContent = 'Pause Celestial Harmonics';
            log(`Audio context resumed, state: ${audioContext.state}`);
          }).catch(err => {
            log(`Audio context resume failed: ${err}`);
            audioStatus.textContent = 'Click again to activate harmonics';
          });
        } else {
          isPlaying = !isPlaying;
          isAnimating = !isAnimating;
          audioStatus.textContent = isPlaying ? 'Celestial harmonics active' : 'Harmonics and orbits paused';
          welcomeButton.textContent = isPlaying ? 'Pause Celestial Harmonics' : 'Key of the Milky Way';
          gainNode.gain.setValueAtTime(isPlaying ? 0.1 : 0, audioContext.currentTime);
          log(`Audio toggled: ${isPlaying ? 'On' : 'Off'}`);
          log(`Animation toggled: ${isAnimating ? 'On' : 'Off'}`);
        }
      }
    });

    // Chakra Nodes and Prime Paths
    function createPrimePathSystem() {
      primes.slice(0, 50).forEach((prime, index) => {
        const node = document.createElement('div');
        node.className = 'chakra-node';
        node.dataset.prime = prime;
        node.style.backgroundColor = primeInterpretations[prime].color;
        primePath.appendChild(node);
      });
      log('50 chakra nodes created with color shift veneer');
    }

    function updateNodePositions(timestamp) {
      if (!isAnimating) {
        log('Animation paused, skipping node position update');
        return requestAnimationFrame(updateNodePositions);
      }
      const nodes = document.querySelectorAll('.chakra-node');
      if (nodes.length === 0) {
        log('No chakra nodes found');
        return requestAnimationFrame(updateNodePositions);
      }
      nodes.forEach((node, index) => {
        const prime = parseInt(node.dataset.prime);
        const radius = 120 + index * 8;
        const angle = (timestamp / 1000) * (360 / (288 / (index + 1))) % 360;
        const x = 50 + (radius / 400) * 100 * Math.cos(angle * Math.PI / 180) * 1.5;
        const y = 50 + (radius / 400) * 100 * Math.sin(angle * Math.PI / 180);
        node.style.left = `${x}%`;
        node.style.top = `${y}%`;
        node.style.display = 'block'; // Ensure nodes are visible
      });
      drawPrimeConnections();
      requestAnimationFrame(updateNodePositions);
      log('Chakra nodes orbiting singularity');
    }

    function drawPrimeConnections() {
      const existingLines = document.querySelectorAll('.path-line');
      existingLines.forEach(line => line.remove());
      const nodes = document.querySelectorAll('.chakra-node');
      nodes.forEach((node1, i) => {
        const prime1 = parseInt(node1.dataset.prime);
        nodes.forEach((node2, j) => {
          if (i < j) {
            const prime2 = parseInt(node2.dataset.prime);
            if (isPrimeHarmonicPair(prime1, prime2)) {
              const x1 = parseFloat(node1.style.left);
              const y1 = parseFloat(node1.style.top);
              const x2 = parseFloat(node2.style.left);
              const y2 = parseFloat(node2.style.top);
              const line = document.createElement('div');
              line.className = 'path-line';
              const length = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
              const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
              line.style.width = `${length}%`;
              line.style.left = `${x1}%`;
              line.style.top = `${y1}%`;
              line.style.transform = `rotate(${angle}deg)`;
              primePath.appendChild(line);
            }
          }
        });
      });
      log('Prime path connections drawn');
    }

    function isPrimeHarmonicPair(p1, p2) {
      return Math.abs(p1 - p2) <= 10;
    }

    // Shimmer Effect
    function createShimmer() {
      for (let i = 0; i < 50; i++) {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.style.width = `${Math.random() * 6 + 2}px`;
        sparkle.style.height = sparkle.style.width;
        sparkle.style.left = `${50 + Math.random() * 40 - 20}%`;
        sparkle.style.top = `${50 + Math.random() * 40 - 20}%`;
        sparkle.style.animationDelay = `${Math.random() * 1}s`;
        shimmerField.appendChild(sparkle);
        setTimeout(() => sparkle.remove(), 2000);
      }
      log('Enhanced shimmer effect triggered');
    }

    // Harmonic Clock and Phase Shifts
    const cycleTime = 36;
    const phaseShiftInterval = (12 / 360) * cycleTime; // 1.2s
    const toneInterval = (36 / 360) * cycleTime; // 3.6s
    const gongInterval = (72 / 360) * cycleTime; // 7.2s
    const ln1836Time = Math.log(1836); // ~7.515s
    const specialAngles = [19.47, 36, 72, 108, 144];
    const specialTimes = specialAngles.map(angle => (angle / 360) * cycleTime);
    let lastPhaseShift = 0, lastTone = 0, lastGong = 0, lastLn1836 = 0, currentPrimeIndex = 0;

    function harmonicClock(timestamp) {
      const elapsed = timestamp / 1000;
      const cycleElapsed = elapsed % cycleTime;

      // 12° Phase Shifts and Heartbeat
      if (elapsed - lastPhaseShift >= phaseShiftInterval) {
        if (isPlaying && audioContext && audioContext.state === 'running') {
          gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
          createHeartbeat();
          setTimeout(() => gainNode.gain.setValueAtTime(0.1, audioContext.currentTime), 800);
        } else if (audioContext) {
          log(`Heartbeat skipped, context state: ${audioContext.state}`);
        }
        ouroboros.style.transform = `rotate(-${((elapsed % cycleTime) / cycleTime) * 360}deg) scale(1.05)`;
        setTimeout(() => {
          ouroboros.style.transform = `rotate(-${((elapsed % cycleTime) / cycleTime) * 360}deg) scale(1)`;
        }, 200);
        lastPhaseShift = elapsed;
        log('Phase shift at 12°');
      }

      // 36° Tone Triggers
      if (elapsed - lastTone >= toneInterval) {
        const prime = allPrimes[currentPrimeIndex % allPrimes.length];
        const interpretation = primeInterpretations[prime];
        if (interpretation) {
          if (interpretation.freq && isPlaying && audioContext && audioContext.state === 'running') {
            createPrimeChorus(prime);
            cymaticField.style.animationDuration = `${1 / (interpretation.freq / 1000)}s`;
          } else if (interpretation.lightFreq && isPlaying && audioContext && audioContext.state === 'running') {
            createLightChorus(prime);
            createShimmer();
            cymaticField.style.animationDuration = `${1 / (interpretation.lightFreq / 1000)}s`;
          } else if (audioContext) {
            log(`Chorus skipped for prime ${prime}, context state: ${audioContext.state}`);
          }
          displayPrime(interpretation);
        }
        currentPrimeIndex++;
        lastTone = elapsed;
        log('Choral chorus at 36°');
      }

      // 72° Gong Triggers
      if (elapsed - lastGong >= gongInterval) {
        if (isPlaying && audioContext && audioContext.state === 'running') {
          createGongDrone();
        }
        lastGong = elapsed;
        log('Javanese gong at 72°');
      }

      // ln(1836) Resonance (~7.515s)
      if (cycleElapsed >= ln1836Time && elapsed - lastLn1836 >= cycleTime) {
        const interpretation = primeInterpretations[1836];
        displayPrime(interpretation);
        createRipple('blue');
        cymaticField.style.boxShadow = `0 0 40px #00b7eb`;
        setTimeout(() => cymaticField.style.boxShadow = `0 0 30px rgba(0,183,235,0.6)`, 500);
        lastLn1836 = elapsed;
        log('ln(1836) resonance at 432 Hz triggered');
      }

      // Special Angles
      const currentAngle = ((elapsed % cycleTime) / cycleTime) * 360;
      if (Math.abs(currentAngle - 19.47) < 0.1) {
        if (isPlaying && audioContext && audioContext.state === 'running') {
          createLightChorus(allPrimes[currentPrimeIndex % allPrimes.length]);
        }
        cymaticField.style.boxShadow = `0 0 30px gold`;
        setTimeout(() => cymaticField.style.boxShadow = `0 0 30px rgba(0,183,235,0.6)`, 500);
        createRipple('gold');
        log('Special effect at 19.47°');
      } else if (specialAngles.slice(2).some(angle => Math.abs(currentAngle - angle) < 0.1)) {
        if (isPlaying && audioContext && audioContext.state === 'running') {
          createLightChorus(allPrimes[currentPrimeIndex % allPrimes.length]);
        }
        createShimmer();
        const nodes = document.querySelectorAll('.chakra-node');
        nodes.forEach(node => {
          node.style.backgroundColor = `hsl(${Math.random() * 360}, 80%, 60%)`;
        });
        setTimeout(() => {
          nodes.forEach((node, i) => {
            node.style.backgroundColor = primeInterpretations[primes[i]].color;
          });
        }, 1000);
        log(`Surprise effect at ${currentAngle}°`);
      }

      if (elapsed - lastPhaseShift >= cycleTime) lastPhaseShift = elapsed - cycleTime;
      if (elapsed - lastTone >= cycleTime) lastTone = elapsed - cycleTime;
      if (elapsed - lastGong >= cycleTime) lastGong = elapsed - cycleTime;
      requestAnimationFrame(harmonicClock);
    }

    function displayPrime(interpretation) {
      primeName.textContent = interpretation.name;
      primeDesc.textContent = interpretation.desc;
      activePrimeDisplay.style.opacity = 1;
      setTimeout(() => {
        activePrimeDisplay.style.opacity = 0;
      }, 2000);
      const pulse = document.createElement('div');
      pulse.className = 'prime-pulse';
      pulse.textContent = interpretation.name;
      pulse.style.color = interpretation.color;
      pulse.style.left = `${50 + Math.random() * 20 - 10}%`;
      pulse.style.top = `${50 + Math.random() * 20 - 10}%`;
      document.querySelector('.cosmic-stage').appendChild(pulse);
      setTimeout(() => {
        pulse.style.opacity = 0;
        pulse.style.transform = 'translateY(-100px)';
        setTimeout(() => pulse.remove(), 1000);
      }, 1000);
      log(`Prime title ${interpretation.name} displayed`);
    }

    function createRipple(color = 'gold') {
      const ripple = document.createElement('div');
      ripple.className = 'ripple-circle';
      ripple.style.width = '100px';
      ripple.style.height = '100px';
      ripple.style.left = '50%';
      ripple.style.top = '50%';
      ripple.style.transform = 'translate(-50%, -50%)';
      ripple.style.borderColor = color;
      cosmicRipple.appendChild(ripple);
      setTimeout(() => {
        ripple.style.transform = 'translate(-50%, -50%) scale(3)';
        ripple.style.opacity = 0.5;
        setTimeout(() => ripple.remove(), 1000);
      }, 50);
    }

    // Snake Trail
    function updateSnakeTrail(timestamp) {
      const segment = document.createElement('div');
      segment.className = 'trail-segment';
      segment.style.left = '50%';
      segment.style.top = '50%';
      snakeTrail.appendChild(segment);
      setTimeout(() => {
        segment.style.opacity = 0;
        setTimeout(() => segment.remove(), 1000);
      }, 5000);
      requestAnimationFrame(updateSnakeTrail);
    }

    // Prime Legend Toggle
    const primeToggle = document.getElementById('primeToggle');
    primeToggle.addEventListener('click', () => {
      const isVisible = primeLegend.style.display === 'block';
      primeLegend.style.display = isVisible ? 'none' : 'block';
      primeToggle.textContent = isVisible ? 'Show Prime Keys' : 'Hide Prime Keys';
      log(`Prime legend toggled to ${primeLegend.style.display}`);
    });

    // Initialize
    populatePrimeLegend();
    createPrimePathSystem();
    requestAnimationFrame(updateNodePositions);
    requestAnimationFrame(harmonicClock);
    requestAnimationFrame(updateSnakeTrail);
    log('Page initialized with fixed chakra nodes, audio, and prime toggle');
  </script>
</body>
</html>
